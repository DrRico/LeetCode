### **1、说说MySQL 事务**

MySQL 事务都是指在 **InnoDB 引擎**下，MyISAM 引擎是不支持事务的。

数据库事务指的是一组数据操作，事务内的操作要么就是全部成功，要么就是全部失败，什么都不做，其实不是没做，是可能做了一部分但是只要有一步失败，就要回滚所有操作，有点一不做二不休的意思。

事务具有：

- 原子性（Atomicity）、使用 undo log ，从而达到回滚
- 一致性（Consistency）、使用 redo log，从而达到故障后恢复
- 隔离性（Isolation）、使用锁以及MVCC,运用的优化思想有读写分离，读读并行，读写并行
- 持久性（Durability）、通过回滚，以及恢复，和在并发环境下的隔离做到一致性。

> ==事务的**原子性**是通过undo log来实现的，事务的**持久性**是通过redo log来实现的，事务的**隔离性**是通过(读写锁+MVCC)来实现的，而事务的终极大 boss**一致性**是通过原子性，持久性，隔离性来实现的！！！==

四个特性，简称 **ACID**，缺一不可。今天要说的就是**隔离性**。

**脏读**

- 脏读指的是读到了其他事务未提交的数据，未提交意味着这些数据可能会回滚，也就是可能最终不会存到数据库中，也就是不存在的数据。读到了并不一定最终存在的数据，这就是脏读。

**可重复读**

- 可重复读指的是**在一个事务内**，**最开始读到的数据**和事务结束前的任意时刻读到的**同一批数据**都是**一致**的。通常针对数据**更新（UPDATE）**操作。

**不可重复读**

- 对比可重复读，不可重复读指的是**在同一事务内**，不同的时刻读到的同一批数据**可能是不一样的**，可能会受到其他事务的影响，比如其他事务改了这批数据并提交了。通常针对数据**更新（UPDATE）**操作。

**幻读**

- 幻读是针对数据**插入（INSERT）**操作来说的。假设事务A对某些行的内容作了更改，但是还未提交，此时事务B插入了与事务A更改前的记录相同的记录行，并且在事务A提交之前先提交了，而这时，在事务A中查询，会发现好像刚刚的更改对于某些数据未起作用，但其实是事务B刚插入进来的，让用户感觉很魔幻，感觉出现了幻觉，这就叫幻读。

**事务隔离级别**

SQL 标准定义了四种隔离级别，Mysql 全都支持。这四种隔离级别分别是：

1. **读未提交（READ UNCOMMITTED）**
2. **读提交 （READ COMMITTED）**
3. **可重复读 （REPEATABLE READ）**
4. **串行化 （SERIALIZABLE）**

从上往下，隔离强度**逐渐增强**，性能**逐渐变差**。采用哪种隔离级别要根据系统需求权衡决定，其中，**可重复读**是 MySQL 的默认级别。

**==事务隔离其实就是为了解决上面提到的脏读、不可重复读、幻读这几个问题==**，下面展示了 4 种隔离级别对这三个问题的解决程度。

![img](https://pic3.zhimg.com/80/v2-2e1a7203478165890e2d09f36cb39857_1440w.jpg)

只有**串行化的隔离级别**解决了全部这 3 个问题，其他的 3 个隔离级别都有缺陷。

**总结**

MySQL 的 InnoDB 引擎才支持事务，其中可重复读是默认的隔离级别。

读未提交和串行化基本上是不需要考虑的隔离级别，前者不加锁限制，后者相当于单线程执行，效率太差。

读提交解决了脏读问题，行锁解决了并发更新的问题。并且 MySQL 在可重复读级别解决了幻读问题，是通过行锁和间隙锁的组合 Next-Key 锁实现的。

总之，从隔离性的实现可以看出这是一场数据的**可靠性与性能之间的权衡**：

==可靠性性高的，并发性能低(比如Serializable)。可靠性低的，并发性能高(比如 Read Uncommitted)==



### [2、数据库的索引](https://blog.csdn.net/ys_230014/article/details/88773918)

**从逻辑角度**：

**1).普通索引：**普通索引是最基本的索引，它没有任何限制，允许在定义索引的列中插入重复值和空值

**2).唯一索引：**索引列的值必须唯一，允许有空值，如果是组合索引，列值的组合必须唯一

**3).主键索引：**主键索引是一种特殊的唯一索引，一个表只能有一个主键，不允许有空值，一般是在创建表的时候指定主键，主键默认就是主键索引

**4).组合索引：**多个字段上创建的索引，只有在查询条件中使用了创建索引时的第一个字段，索引才会被使用

**5).全文索引：**索引类型为FULLTEXT，允许有重复值和空值，可以在char、varchar、text类型的列上创建，Mysql中MyISAM和InnoDB存储引擎都支持。主要用来查找文本中的关键字，而不是直接与索引中的值比较，它更像是一个搜索引擎，全文索引需要配合match against操作使用，而不是一般的where语句加like

**6).空间索引：**空间索引是对空间数据类型的字段建立的索引，Mysql中的空间索引类型有4种，GEOMETRY、POINT、LINESTRING、POLYGON，创建空间索引的列，必须将其声明为not null，Mysql中只有MyISAM存储引擎支持创建空间索引

**从物理存储角度**

**1、聚集索引：**聚集索引确定表中数据的物理顺序，一个表中只能包含一个聚集索引，但该索引可以包含多个列，聚集索引对于经常要搜索范围值的列特别有效，使用聚集索引找到包含第一个值的行后，便可以确保包含后续索引值的行在物理相邻

2、聚集索引中索引的叶节点就是数据节点

3、非聚集索引的叶节点仍然是索引节点，只不过有一个指针指向相应的数据块

**从数据结构角度**

1).hash索引：hash索引基于hash表实现，只有查询条件精确匹配hash索引中的所有列才会用到hash索引，存储引擎会为hash索引中的每一列都计算hash码，hash索引中存储的就是hash码，所以每次读取都会进行两次查询

2).B+Tree索引

































































